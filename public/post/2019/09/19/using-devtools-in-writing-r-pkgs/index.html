<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> 使用 devtools 速写 R 包 | Hugo Prose</title>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/css/article.min.css,npm/@xiee/utils/css/heading-anchor.min.css">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用 devtools 速写 R 包"/>
<meta name="twitter:description" content="因为“包治百病”，所以每个人都会到需要写包的时候。作为一个讲原则的开发者，Hadley Wickham 的写包指南还是要看一下的。写包，“so easy！”
使用 devtools 创建一个 R 包的流程 # 在指定路径创建一个包的骨架，包括文件夹结构和配置文件 create_package(&quot;~/path/to/foofactors&quot;) # 初始化 git use_git() # 在 R 目录下面新建一个 fbind.R 文件 use_r(&quot;fbind&quot;) # 导入编写好的代码（引入fbind函数），测试函数代码 load_all() # 检测包的可用性 check() load_all() 是测试代码的时候用起来非常方便的命令。
接下来，需要编辑 DESCRIPTION 文件，为包写一个简单的说明（略）。
# 应用一个开源软件协议 use_mit_license(&quot;Jane Doe&quot;) # 生成帮助文档 document() # 再次检查包的可用性 check() # 安装包 install() 安装完成后，可以使用真实环境测试一下。
library(foofactors) a &lt;- factor(c(&quot;character&quot;, &quot;hits&quot;, &quot;your&quot;, &quot;eyeballs&quot;)) b &lt;- factor(c(&quot;but&quot;, &quot;integer&quot;, &quot;where it&quot;, &quot;counts&quot;)) fbind(a, b) 到此为止，已经完成了一个包的创建。当然，在实际的开发环境中，代码会不断更新，也需要对包的功能进行测试，还需要写使用文档等内容，这会需要一个 Git、测试和代码托管等操作，下面介绍的命令可以帮助你完成这些任务。
使用 use_testthat() # 将会生成一个 tests/testthat."/>


  </head>

  <body>

    <nav class="menu">
    <ul>
      <li class="left">
        <a href="/"><span>Hugo Prose</span></a>
      </li>
      
      <li>
        <a href="/">Home</a>
      </li>
      
      <li>
        <a href="/about/">About</a>
      </li>
      
      <li>
        <a href="/sitemap/">Sitemap</a>
      </li>
      
      <li id="menu-search">
        <a href="/#">Search</a>
      </li>
      
      <li>
        <a href="/index.xml">Subscribe</a>
      </li>
      
    </ul>
    </nav>


<div class="container single">
<main>

<div class="article-meta">
<h1><span class="title">使用 devtools 速写 R 包</span></h1>

<h3 class="author">
gaoch
</h3>

<h3 class="date">2019-09-19</h3>
<p class="terms">
  
  
  Categories: <a href="/categories/r">R</a> 
  
  
  
  
</p>
</div>

<div class="article">
<p>因为“包治百病”，所以每个人都会到需要写包的时候。作为一个讲原则的开发者，Hadley Wickham 的<a href="https://r-pkgs.org/index.html">写包指南</a>还是要看一下的。写包，“so easy！”</p>
<hr>
<h1 id="使用-devtools-创建一个-r-包的流程">使用 <code>devtools</code> 创建一个 R 包的流程</h1>
<pre><code class="language-r"># 在指定路径创建一个包的骨架，包括文件夹结构和配置文件
create_package(&quot;~/path/to/foofactors&quot;)

# 初始化 git
use_git()

# 在 R 目录下面新建一个 fbind.R 文件
use_r(&quot;fbind&quot;)

# 导入编写好的代码（引入fbind函数），测试函数代码
load_all()

# 检测包的可用性
check()

</code></pre>
<p><code>load_all()</code> 是测试代码的时候用起来非常方便的命令。</p>
<p>接下来，需要编辑 <code>DESCRIPTION</code> 文件，为包写一个简单的说明（略）。</p>
<pre><code class="language-r"># 应用一个开源软件协议
use_mit_license(&quot;Jane Doe&quot;)

# 生成帮助文档
document()

# 再次检查包的可用性
check()

# 安装包
install()
</code></pre>
<p>安装完成后，可以使用真实环境测试一下。</p>
<pre><code class="language-r">library(foofactors)

a &lt;- factor(c(&quot;character&quot;, &quot;hits&quot;, &quot;your&quot;, &quot;eyeballs&quot;))
b &lt;- factor(c(&quot;but&quot;, &quot;integer&quot;, &quot;where it&quot;, &quot;counts&quot;))

fbind(a, b)
</code></pre>
<p>到此为止，已经完成了一个包的创建。当然，在实际的开发环境中，代码会不断更新，也需要对包的功能进行测试，还需要写使用文档等内容，这会需要一个 Git、测试和代码托管等操作，下面介绍的命令可以帮助你完成这些任务。</p>
<h2 id="使用-use_testthat">使用 <code>use_testthat()</code></h2>
<pre><code># 将会生成一个 tests/testthat.R 文件，使 testthat 流程可用
use_testthat()

# 将会生成一个 tests/test-fbind.R 文件
use_test(&quot;fbind&quot;)
</code></pre>
<p>在 <code>tests/test-fbind.R</code> 文件中，写入下列测试代码。</p>
<pre><code class="language-r">test_that(&quot;fbind() binds factor (or character)&quot;, {
  x &lt;- c(&quot;a&quot;, &quot;b&quot;)
  x_fact &lt;- factor(x)
  y &lt;- c(&quot;c&quot;, &quot;d&quot;)
  z &lt;- factor(c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;))

  expect_identical(fbind(x, y), z)
  expect_identical(fbind(x_fact, y), z)
})
</code></pre>
<p>运行测试。</p>
<pre><code class="language-r">test()
</code></pre>
<p><code>expect_equal()</code> 和 <code>expect_identical()</code> 是常用的两个测试函数。其中 <code>expect_equal()</code> 使用 <code>all.equal()</code> 函数来比较数值，有一定的敏感性（检测不出非常小的差异）；<code>expect_identical()</code> 则使用 <code>identical()</code> 来进行比较 [2]。</p>
<h2 id="使用其它软件包中的函数">使用其它软件包中的函数</h2>
<pre><code># 导入 forcats 包
use_package(&quot;forcats&quot;)

# 创建一个新函数 fcount
use_r(&quot;fcount&quot;)

</code></pre>
<p>接下来编写 <code>fcount.R</code> 其中的代码。重复上面的步骤进行测试和安装。</p>
<h2 id="使用-github">使用 GitHub</h2>
<p><code>use_github()</code> 将帮助你使用 GitHub 的一些功能。</p>
<h2 id="使用-readme">使用 README</h2>
<p><code>use_readme_rmd()</code> 帮助你创建一个 <code>README.rmd</code> 的模板。根据模板的提示，编写基本的使用说明，加入一些示例等。</p>
<p>使用下面的命令生成 <code>README.md</code> 文件。</p>
<pre><code class="language-r">rmarkdown::render(&quot;README.Rmd&quot;) ## or use &quot;Knit HTML&quot; in RStudio
</code></pre>
<p>还可以使用 <code>use_vignette(&quot;my-vignette&quot;)</code> 来生成一个文档模板。</p>
<p><strong>参考资料</strong></p>
<ol>
<li><a href="https://r-pkgs.org/whole-game.htm">https://r-pkgs.org/whole-game.htm</a></li>
<li><a href="https://r-pkgs.org/tests.html">https://r-pkgs.org/tests.html</a></li>
</ol>
<h1 id="使用-rbuildignore-排除部分文件">使用 <code>.Rbuildignore</code> 排除部分文件</h1>
<p><code>.Rbuildignore</code> 中列举了打包软件包时需要排除的文件。</p>
<h1 id="起个好名字">起个好名字</h1>
<p>有个包可以帮助你检查包的名称是否可用。不过，Google 一下也是未尝不可的（就不用安装一个用处不大的available了）。</p>
<pre><code>library(available)

available(&quot;doofus&quot;)
</code></pre>
<h1 id="代码向后兼容">代码向后兼容</h1>
<p>如果要改变一个函数，最好先声明废弃，然后在后来的版本中才去掉它。</p>
<pre><code># 0.6.0
fun &lt;- function(x, y, z) {
  .Deprecated(&quot;sum&quot;)
  x + y + z
}

fun(1, 2, 3)
#&gt; Warning: 'fun' is deprecated.
#&gt; Use 'sum' instead.
#&gt; See help(&quot;Deprecated&quot;)
#&gt; [1] 6
</code></pre>
<p>如上所示，在调用 <code>fun(1,2,3)</code> 时，会有相应的提示。</p>
<p>参见：https://r-pkgs.org/release.html</p>
<h1 id="编写函数的文档">编写函数的文档</h1>
<p>函数文档一般使用 roxygen comments 自动生成。</p>
<pre><code>#' Add together two numbers.
#' 
#' @param x A number.
#' @param y A number.
#' @return The sum of \code{x} and \code{y}.
#' @examples
#' add(1, 1)
#' add(10, 1)
add &lt;- function(x, y) {
  x + y
}

</code></pre>
<p><code>@</code> 在 roxygen 中具有特殊含义，如果需要 “@”，则必须写成<code>@@</code>才可以。类似地，<code>%</code> 写成 <code>\%</code>，<code>\</code> 写成 <code>\\</code>。</p>
<p>除了最常用的几个以外，还有下列一些经常会用到的 Tag。</p>
<ul>
<li><code>@section Warning:</code> 开始一个小标题。</li>
<li><code>@seealso \url{http://a.cn}, \code{\link{func}}</code> 添加一些链接。</li>
<li><code>@family aggregate functions</code> 函数家族</li>
<li><code>@alias alias1 alias2</code> alias</li>
<li><code>@keywords key1 key2</code></li>
<li><code>@name foo</code> 取个名字</li>
<li><code>@inheritParams foo</code> 继承 <code>foo</code> 函数的参数说明</li>
<li><code>@rdname foo</code> 多个函数复用一个 Rd 文档， <code>foo</code> 可以是函数名或者 <code>@name</code> 指定的位置。</li>
</ul>
<h2 id="文档的格式化">文档的格式化</h2>
<p>这部分内容是学习 <a href="https://r-pkgs.org/man.html">https://r-pkgs.org/man.html</a> 的笔记。</p>
<h3 id="设定字符格式">设定字符格式</h3>
<ul>
<li><code>\emph{italics}</code>: <em>italics</em>.</li>
<li><code>\strong{bold}</code>: <strong>bold</strong>.</li>
<li><code>\code{r_function_call(with = &quot;arguments&quot;)}</code>:
<code>r_function_call(with = &quot;arguments&quot;)</code> (format inline code)</li>
<li><code>\preformatted{}</code>: format text as-is, can be used for multi-line code</li>
</ul>
<h3 id="超链接">超链接</h3>
<p>To other documentation:</p>
<ul>
<li><code>\code{\link{function}}</code>: function in this package.</li>
<li><code>\code{\link[MASS]{abbey}}</code>: function in another package.</li>
<li><code>\link[=dest]{name}</code>: link to dest, but show name.</li>
<li><code>\code{\link[MASS:abbey]{name}}</code>: link to function in another package, but show name.</li>
<li><code>\linkS4class{abc}</code>: link to an S4 class.</li>
</ul>
<p>To the web:</p>
<ul>
<li><code>\url{http://rstudio.com}</code>: a url.</li>
<li><code>\href{http://rstudio.com}{Rstudio}</code>:, a url with custom link text.</li>
<li><code>\email{hadley@@rstudio.com}</code> (note the doubled <code>@</code>): an email address.</li>
</ul>
<h3 id="有序列表和无序列表">有序列表和无序列表</h3>
<ul>
<li>
<p>Ordered (numbered) lists:</p>
<pre><code class="language-{r}">#' \enumerate{
#'   \item First item
#'   \item Second item
#' }
</code></pre>
</li>
<li>
<p>Unordered (bulleted) lists:</p>
<pre><code class="language-{r}">#' \itemize{
#'   \item First item
#'   \item Second item
#' }
</code></pre>
</li>
<li>
<p>Definition (named) lists:</p>
<pre><code class="language-{r}">#' \describe{
#'   \item{One}{First item}
#'   \item{Two}{Second item}
#' }
</code></pre>
</li>
</ul>
<h3 id="数学公式">数学公式</h3>
<p>You can use standard LaTeX math (with no extensions). Choose between either inline or block display:</p>
<ul>
<li><code>\eqn{a + b}</code>: inline equation.</li>
<li><code>\deqn{a + b}</code>: display (block) equation.</li>
</ul>
<h1 id="配置-usethis-options">配置 <code>usethis</code> options</h1>
<p>将下面的内容加入到 <code>.Rprofile</code> 文件中,使用 <code>usethis</code> 时更加便捷。</p>
<pre><code># usethis options
options(
  usethis.full_name = &quot;Chun-Hui Gao&quot;,
  usethis.description = list(
    `Authors@R` = 'person(&quot;Chun-Hui&quot;, &quot;Gao&quot;, email = &quot;gaospecial@gmail.com&quot;, 
                    role = c(&quot;aut&quot;, &quot;cre&quot;), comment = c(ORCID = &quot;0000-0002-1445-7939&quot;))',
    License = &quot;GPL3 + file LICENSE&quot;,
    Version = &quot;0.0.1&quot;
  ),
  usethis.protocol  = &quot;ssh&quot;
)
</code></pre>

</div>
</main>

<section class="appendix">


<div>
  <div class="side side-left"><h3>Author&#39;s bio</h3></div>
  <div>






</div>
</div>






<div>
  <div class="side side-left"><h3>Reuse</h3></div>
  Text and figures are licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC BY 4.0</a>. The source code is licensed under MIT. The full source is available at <a href="https://github.com/yihui/hugo-prose">https://github.com/yihui/hugo-prose</a>.
</div>



<div>
  <div class="side side-left"><h3>Suggest changes</h3></div>
  
  
  
    
    
  
  If you find any mistakes (including typos) or want to suggest changes, please feel free to <a href="https://github.com/yihui/hugo-prose/edit/master/exampleSite/content/post/2019-09-19-using-devtools-in-writing-r-pkgs.md" id="edit-link">edit the source file of this page on Github and create a pull request.</a>
</div>




<div>
  <div class="side side-left"><h3>Citation</h3></div>
  <p>For attribution, please cite this work as</p>
  <pre><code>gaoch (2019). 使用 devtools 速写 R 包. Hugo Prose. /post/2019/09/19/using-devtools-in-writing-r-pkgs/</code></pre>
  <p>BibTeX citation</p>
  <pre><code>@misc{
  title = "使用 devtools 速写 R 包",
  author = "gaoch",
  year = "2019",
  journal = "Hugo Prose",
  note = "/post/2019/09/19/using-devtools-in-writing-r-pkgs/"
}</code></pre>
</div>

</section>



<nav class="post-nav">
  <span class="nav-next">&larr; <a href="/post/2019/08/26/r-3-6-rstudio-option-error-has-null-value/" title=Next&#32;post&#32;(older)>升级R到3.6版本后，RStudio使用中出现“option error has NULL value”错误</a></span>
  &hercon;
  <span class="nav-prev"><a href="/post/2019/09/20/rstudio-git-push/" title=Previous&#32;post&#32;(newer)>RStudio 中使用 Git push 时要求输入用户名和密码</a> &rarr;</span>
</nav>





</div>


  <footer>
  


<script src="//yihui.org/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>





<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/number-sections.min.js,npm/@xiee/utils/js/toc.min.js,npm/@xiee/utils/js/sidenotes.min.js,npm/@xiee/utils/js/right-quote.min.js,npm/@xiee/utils/js/center-img.min.js,npm/@xiee/utils/js/fix-pandoc.min.js,npm/@xiee/utils/js/heading-anchor.min.js" defer></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>


  <div class="footer">
  
  <ul class="copyright">
    <li>© <a href="https://en.wikipedia.org/wiki/Seneca_the_Younger">Lucius Annaeus Seneca</a> 4 BC &ndash; AD 65</li>
  </ul>
  
  <ul>
    
    <li>
      <a href="/404.html">Contact</a>
    </li>
    
    <li class="optional">
      <a href="/categories/">Categories</a>
    </li>
    
    <li class="optional">
      <a href="/tags/">Tags</a>
    </li>
    
    <li id="menu-edit">
      <a href="#">Suggest an edit</a>
    </li>
    
    <li>
      <a href="#">Back to top</a>
    </li>
    
  </ul>
  </div>
  
  </footer>
  <script src="/js/features.js" defer></script>
  </body>
</html>

