<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> 排序分析结果作图 | Hugo Prose</title>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/css/article.min.css,npm/@xiee/utils/css/heading-anchor.min.css">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="排序分析结果作图"/>
<meta name="twitter:description" content="数据整理 library(vegan) ## 载入需要的程辑包：permute ## 载入需要的程辑包：lattice ## This is vegan 2.6-4 data(&quot;varespec&quot;) pca &lt;- rda(varespec) 首先看一下结果：
summary(pca) ## ## Call: ## rda(X = varespec) ## ## Partitioning of variance: ## Inertia Proportion ## Total 1826 1 ## Unconstrained 1826 1 ## ## Eigenvalues, and their contribution to the variance ## ## Importance of components: ## PC1 PC2 PC3 PC4 PC5 PC6 ## Eigenvalue 982.9788 464.3040 132.25052 73.9337 48.41829 37.00937 ## PC7 PC8 PC9 PC10 PC11 PC12 ## Eigenvalue 25."/>


  </head>

  <body>

    <nav class="menu">
    <ul>
      <li class="left">
        <a href="/"><span>Hugo Prose</span></a>
      </li>
      
      <li>
        <a href="/">Home</a>
      </li>
      
      <li>
        <a href="/about/">About</a>
      </li>
      
      <li>
        <a href="/sitemap/">Sitemap</a>
      </li>
      
      <li id="menu-search">
        <a href="/#">Search</a>
      </li>
      
      <li>
        <a href="/index.xml">Subscribe</a>
      </li>
      
    </ul>
    </nav>


<div class="container single">
<main>

<div class="article-meta">
<h1><span class="title">排序分析结果作图</span></h1>

<h3 class="author">
gaoch
</h3>

<h3 class="date">2018-10-22</h3>
<p class="terms">
  
  
  Categories: <a href="/categories/r">R</a> 
  
  
  
  Tags: <a href="/tags/pca">PCA</a> <a href="/tags/ggplot2">ggplot2</a> 
  
  
</p>
</div>

<div class="article">
<h1 id="数据整理">数据整理</h1>
<pre><code class="language-r">library(vegan)
</code></pre>
<pre><code>## 载入需要的程辑包：permute
</code></pre>
<pre><code>## 载入需要的程辑包：lattice
</code></pre>
<pre><code>## This is vegan 2.6-4
</code></pre>
<pre><code class="language-r">data(&quot;varespec&quot;)
pca &lt;- rda(varespec)
</code></pre>
<p>首先看一下结果：</p>
<pre><code class="language-r">summary(pca)
</code></pre>
<pre><code>## 
## Call:
## rda(X = varespec) 
## 
## Partitioning of variance:
##               Inertia Proportion
## Total            1826          1
## Unconstrained    1826          1
## 
## Eigenvalues, and their contribution to the variance 
## 
## Importance of components:
##                            PC1      PC2       PC3     PC4      PC5      PC6
## Eigenvalue            982.9788 464.3040 132.25052 73.9337 48.41829 37.00937
##                            PC7      PC8       PC9      PC10     PC11     PC12
## Eigenvalue            25.72624 19.70557 12.274191 10.435361 9.350783 2.798400
##                           PC13      PC14      PC15      PC16      PC17
## Eigenvalue            2.327555 1.3917180 1.2057303 0.8147513 0.3312842
##                            PC18      PC19      PC20      PC21      PC22
## Eigenvalue            0.1866564 1.065e-01 6.362e-02 2.521e-02 1.652e-02
##                            PC23
## Eigenvalue            4.590e-03
## [到达getOption(&quot;max.print&quot;) -- 略过2行]]
## 
## Scaling 2 for species and site scores
## * Species are scaled proportional to eigenvalues
## * Sites are unscaled: weighted dispersion equal on all dimensions
## * General scaling constant of scores:  14.31485 
## 
## 
## Species scores
## 
##                 PC1        PC2        PC3        PC4        PC5        PC6
## Callvulg -1.470e-01  0.3483315 -2.506e-01  0.6029965  0.3961208 -4.608e-01
## Empenigr  1.645e-01 -0.3731965 -5.543e-01 -0.7565217 -0.7432702 -3.484e-01
## Rhodtome -6.787e-02 -0.0810708 -6.464e-02 -0.0963929 -0.1749038 -4.008e-02
## Vaccmyrt -5.429e-01 -0.7446016  1.973e-01 -0.2791788 -0.5688937 -3.689e-01
## Vaccviti  9.013e-02 -0.7247759 -6.555e-01 -1.3366155 -0.7107105 -2.615e-01
## [到达getOption(&quot;max.print&quot;) -- 略过39行]]
## 
## 
## Site scores (weighted sums of species scores)
## 
##         PC1      PC2      PC3      PC4       PC5      PC6
## 18 -1.02674  2.59169 -1.53869 -3.23113 -1.104731 -2.20341
## 15 -2.64700 -1.62646  1.01889  1.88048  1.152767 -1.41888
## 24 -2.44595 -2.01412  0.12182 -2.44215  5.875564  8.03640
## 27 -3.02575 -4.32492  4.44163 -1.54364 -2.466762 -2.57141
## 23 -1.86899 -0.35380 -1.98920 -4.11912 -2.428561 -0.85734
## [到达getOption(&quot;max.print&quot;) -- 略过19行]]
</code></pre>
<h1 id="绘图">绘图</h1>
<p><code>vegan</code> 的结果处理成 <code>data.frame</code> 才能用于 <code>ggplot2</code>。这个过程比较复杂，不过还好有人已经造好了轮子：<code>ggvegan</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。</p>
<p>运行下面命令安装这个包。</p>
<pre><code class="language-r">devtools::install_github(&quot;gavinsimpson/ggvegan&quot;)
</code></pre>
<p>使用 <code>autoplot()</code>。</p>
<pre><code class="language-r">library(ggvegan)
</code></pre>
<pre><code>## 载入需要的程辑包：ggplot2
</code></pre>
<pre><code class="language-r"># 使用空白主题
theme_set(theme_bw())

# 一键绘图
autoplot(pca)
</code></pre>
<img src="/post/2018-10-22-plot-PCA-using-ggplot2_files/figure-html/plot-pca-1.png" width="576" />
<p>还可以使用 <code>fortify()</code> 将对象转变为 <code>data.frame</code>，然后再作图。</p>
<pre><code class="language-r"># 生成数据框
df.pca &lt;- fortify(pca)

# 查看数据
knitr::kable(df.pca[1:5,1:5])
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">score</th>
<th style="text-align:left">label</th>
<th style="text-align:right">PC1</th>
<th style="text-align:right">PC2</th>
<th style="text-align:right">PC3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">species</td>
<td style="text-align:left">Callvulg</td>
<td style="text-align:right">-0.1469634</td>
<td style="text-align:right">0.3483315</td>
<td style="text-align:right">-0.2505840</td>
</tr>
<tr>
<td style="text-align:left">species</td>
<td style="text-align:left">Empenigr</td>
<td style="text-align:right">0.1645106</td>
<td style="text-align:right">-0.3731965</td>
<td style="text-align:right">-0.5543083</td>
</tr>
<tr>
<td style="text-align:left">species</td>
<td style="text-align:left">Rhodtome</td>
<td style="text-align:right">-0.0678718</td>
<td style="text-align:right">-0.0810708</td>
<td style="text-align:right">-0.0646412</td>
</tr>
<tr>
<td style="text-align:left">species</td>
<td style="text-align:left">Vaccmyrt</td>
<td style="text-align:right">-0.5428697</td>
<td style="text-align:right">-0.7446016</td>
<td style="text-align:right">0.1973452</td>
</tr>
<tr>
<td style="text-align:left">species</td>
<td style="text-align:left">Vaccviti</td>
<td style="text-align:right">0.0901303</td>
<td style="text-align:right">-0.7247759</td>
<td style="text-align:right">-0.6554941</td>
</tr>
</tbody>
</table>
<pre><code class="language-r"># 绘图
require(dplyr)
</code></pre>
<pre><code>## 载入需要的程辑包：dplyr
</code></pre>
<pre><code>## 
## 载入程辑包：'dplyr'
</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag
</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</code></pre>
<pre><code class="language-r">ggplot(mapping=aes(PC1,PC2,shape=score,color=score)) +
  geom_point(data=dplyr::filter(df.pca,score==&quot;sites&quot;)) +
  geom_segment(data=dplyr::filter(df.pca,score==&quot;species&quot;),
               mapping = aes(x=0,y=0,xend=PC1,yend=PC2),
               arrow = arrow(length = unit(0.1,&quot;inches&quot;)),show.legend = F) +
  geom_text(mapping = aes(PC1,PC2,label=label),data=filter(df.pca,score==&quot;species&quot;),show.legend = F)
</code></pre>
<img src="/post/2018-10-22-plot-PCA-using-ggplot2_files/figure-html/fortify-plot-1.png" width="576" />
<p>除了PCA分析，<code>ggvegan</code>还顺便支持了CCA，RDA，metaMDS等<code>vegan</code>的分析结果。</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>ggvegan on GitHub: <a href="https://github.com/gavinsimpson/ggvegan">https://github.com/gavinsimpson/ggvegan</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</div>
</main>

<section class="appendix">


<div>
  <div class="side side-left"><h3>Author&#39;s bio</h3></div>
  <div>






</div>
</div>






<div>
  <div class="side side-left"><h3>Reuse</h3></div>
  Text and figures are licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC BY 4.0</a>. The source code is licensed under MIT. The full source is available at <a href="https://github.com/yihui/hugo-prose">https://github.com/yihui/hugo-prose</a>.
</div>



<div>
  <div class="side side-left"><h3>Suggest changes</h3></div>
  
  
  
    
  
  If you find any mistakes (including typos) or want to suggest changes, please feel free to <a href="https://github.com/yihui/hugo-prose/edit/master/exampleSite/content/post/2018-10-22-plot-PCA-using-ggplot2.Rmd" id="edit-link">edit the source file of this page on Github and create a pull request.</a>
</div>




<div>
  <div class="side side-left"><h3>Citation</h3></div>
  <p>For attribution, please cite this work as</p>
  <pre><code>gaoch (2018). 排序分析结果作图. Hugo Prose. /post/2018/10/22/plot-pca-using-ggplot2/</code></pre>
  <p>BibTeX citation</p>
  <pre><code>@misc{
  title = "排序分析结果作图",
  author = "gaoch",
  year = "2018",
  journal = "Hugo Prose",
  note = "/post/2018/10/22/plot-pca-using-ggplot2/"
}</code></pre>
</div>

</section>



<nav class="post-nav">
  <span class="nav-next">&larr; <a href="/post/2018/10/17/bray-curtis-dissimilarity/" title=Next&#32;post&#32;(older)>Bray Curtis Dissimilarity</a></span>
  &hercon;
  <span class="nav-prev"><a href="/post/2018/10/22/ordination-analysis-in-r/" title=Previous&#32;post&#32;(newer)>常见排序分析方法及R语言实现</a> &rarr;</span>
</nav>





</div>


  <footer>
  






<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/number-sections.min.js,npm/@xiee/utils/js/toc.min.js,npm/@xiee/utils/js/sidenotes.min.js,npm/@xiee/utils/js/right-quote.min.js,npm/@xiee/utils/js/center-img.min.js,npm/@xiee/utils/js/fix-pandoc.min.js,npm/@xiee/utils/js/heading-anchor.min.js" defer></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>


  <div class="footer">
  
  <ul class="copyright">
    <li>© <a href="https://en.wikipedia.org/wiki/Seneca_the_Younger">Lucius Annaeus Seneca</a> 4 BC &ndash; AD 65</li>
  </ul>
  
  <ul>
    
    <li>
      <a href="/404.html">Contact</a>
    </li>
    
    <li class="optional">
      <a href="/categories/">Categories</a>
    </li>
    
    <li class="optional">
      <a href="/tags/">Tags</a>
    </li>
    
    <li id="menu-edit">
      <a href="#">Suggest an edit</a>
    </li>
    
    <li>
      <a href="#">Back to top</a>
    </li>
    
  </ul>
  </div>
  
  </footer>
  <script src="/js/features.js" defer></script>
  </body>
</html>

