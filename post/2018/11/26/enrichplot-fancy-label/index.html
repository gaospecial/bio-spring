<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> 在enrichplot中使用更好的Label | BIO-SPRING</title>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@v1.13.54/css/article.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/heading-anchor.min.css">
    <link rel="stylesheet" href="/bio-spring/css/style.css" />
    <link rel="stylesheet" href="/bio-spring/css/fonts.css" />
    <link rel="stylesheet" href="/bio-spring/css/custom.css" />
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="在enrichplot中使用更好的Label">
  <meta name="twitter:description" content="GO term 太长, enrichplot 好局促怎么办? 例如下面这个样子:
# 可重复运行的代码拿去 library(clusterProfiler) library(org.Hs.eg.db) library(ggplot2) data(geneList, package = &#34;DOSE&#34;) gene &lt;- names(geneList)[abs(geneList)&gt;3] gene.df &lt;- bitr(gene, fromType = &#34;ENTREZID&#34;, toType = c(&#34;ENSEMBL&#34;, &#34;SYMBOL&#34;), OrgDb = org.Hs.eg.db) ego &lt;- enrichGO(gene = gene, universe = names(geneList), OrgDb = org.Hs.eg.db, ont = &#34;BP&#34;, pAdjustMethod = &#34;BH&#34;, pvalueCutoff = 0.01, qvalueCutoff = 0.05, readable = TRUE) 这个例子中, 有一个 “microtubule cytoskeleton …” 特别长, 事实上有些 GO term 比这还要长很多. 不巧在这个例子中没有出现, 那就拿它开刀吧.">


  </head>

  <body>

    <nav class="menu sticky-top">
    <ul>
      <li class="left">
        <a href="/"><span>BIO-SPRING</span></a>
      </li>
      
      <li>
        <a href="/bio-spring">Home</a>
      </li>
      
      <li>
        <a href="/bio-spring/post/">Blog Post</a>
      </li>
      
      <li>
        <a href="/bio-spring/publication/full-publication-list/">Publication</a>
      </li>
      
      <li>
        <a href="/bio-spring/work/">Work</a>
      </li>
      
      <li id="menu-search">
        <a href="/bio-spring/#">Search</a>
      </li>
      
    </ul>
    </nav>


<div class="container single">
<main>

<div class="article-meta">
<h1><span class="title">在enrichplot中使用更好的Label</span></h1>

<h3 class="author">
gao
</h3>

<h3 class="date">2018-11-26</h3>
<p class="terms">
  
  
  Categories: <a href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF">信息技术</a> 
  
  
  
  Tags: <a href="/tags/ggplot2">ggplot2</a> <a href="/tags/enrichplot">enrichplot</a> 
  
  
</p>
</div>

<div class="article">
<h1 id="go-term-太长-enrichplot-好局促怎么办">GO term 太长, enrichplot 好局促怎么办?</h1>
<p>例如下面这个样子:</p>
<pre><code class="language-r"># 可重复运行的代码拿去
library(clusterProfiler)
library(org.Hs.eg.db)
library(ggplot2)

data(geneList, package = &quot;DOSE&quot;)
gene &lt;- names(geneList)[abs(geneList)&gt;3]
gene.df &lt;- bitr(gene, fromType = &quot;ENTREZID&quot;,
        toType = c(&quot;ENSEMBL&quot;, &quot;SYMBOL&quot;),
        OrgDb = org.Hs.eg.db)

ego &lt;- enrichGO(gene          = gene,
                universe      = names(geneList),
                OrgDb         = org.Hs.eg.db,
                ont           = &quot;BP&quot;,
                pAdjustMethod = &quot;BH&quot;,
                pvalueCutoff  = 0.01,
                qvalueCutoff  = 0.05,
                readable      = TRUE)
</code></pre>
<p>这个例子中, 有一个 &ldquo;microtubule cytoskeleton &hellip;&rdquo; 特别长, 事实上有些 GO term 比这还要长很多. 不巧在这个例子中没有出现, 那就拿它开刀吧.</p>
<pre><code class="language-r">dotplot(ego)
</code></pre>
<img src="bio-spring/post/2018/11/26/enrichplot-fancy-label/index.zh_files/figure-html/unnamed-chunk-2-1.png" width="672" />
<p>刀法比较犀利, 主要是定义一个短 label 的函数, 将其传递给 <code>scale_y_discrete()</code> 即可. <strong>在输出ggplot 对象时做修改</strong>.</p>
<pre><code class="language-r">#' Truncate string vector of ggplot axis label
#'
#' @param label    a ordered string vector
#' @param maxLen   max length of character (nchar) to show in label
#' @param maxWord  max count of words allowed to show in label
#' @param pattern  Word separater
#' @param dot      If true, three dots will added to truncated label
#'
#' @return a vector of truncated strings
#' @export
#'
#' @examples
short_label &lt;- function(label, maxLen = 50, maxWord = 5, pattern = &quot; &quot;, dot = TRUE){
  l &lt;- strsplit(label, pattern)
  short_label &lt;- vector(&quot;character&quot;,length(l))
  
  for (i in seq_along(l)){
    truncated &lt;- FALSE
    s &lt;- l[[i]]
    if (length(s) &gt; maxWord){
      ll &lt;- paste(s[1:maxWord], collapse = &quot; &quot;)
      truncated &lt;- TRUE
    }
    else{
      ll &lt;- paste(s, collapse = &quot; &quot;)
    }
    
    if (nchar(ll) &gt; maxLen){
      ll &lt;- substr(ll, 1, maxLen)
      truncated &lt;- TRUE
    }
    
    if (dot &amp; truncated) ll &lt;- paste(ll, &quot;...&quot;,sep = &quot; &quot;)
    
    short_label[[i]] &lt;- ll
  }
  attr(short_label, &quot;pos&quot;) &lt;- attr(label,&quot;pos&quot;)
  return(short_label)
}
</code></pre>
<p>默认最多显示 50 个字符, 5 个单词.</p>
<pre><code class="language-r">dotplot(ego) + scale_y_discrete(label=short_label)
</code></pre>
<pre><code>## Scale for y is already present.
## Adding another scale for y, which will replace the existing scale.
</code></pre>
<img src="bio-spring/post/2018/11/26/enrichplot-fancy-label/index.zh_files/figure-html/unnamed-chunk-4-1.png" width="672" />
<p>如果最多只显示 3 个单词, 则可以写成这样:</p>
<pre><code class="language-r">dotplot(ego) + 
  scale_y_discrete(
    label=function(x)short_label(x,maxWord = 3)
    )
</code></pre>
<pre><code>## Scale for y is already present.
## Adding another scale for y, which will replace the existing scale.
</code></pre>
<img src="bio-spring/post/2018/11/26/enrichplot-fancy-label/index.zh_files/figure-html/unnamed-chunk-5-1.png" width="672" />
<p><strong>注意</strong>: <code>short_label()</code> 带参数和不带参数时具有不同的调用方法.</p>
<h1 id="不满意-enrichplot-x轴排序怎么破">不满意 enrichplot x轴排序怎么破?</h1>
<p>我觉得 compareCluster 的输出可能会更加有比较价值. 但是发现 x 轴的排序有时候会有一些问题.</p>
<p><code>compareCluster</code> 只能根据其本来固有的顺序排序, 这在程序上没有问题. 但用起来可能情况比较复杂.</p>
<pre><code class="language-r">data(&quot;gcSample&quot;)

names(gcSample)
</code></pre>
<pre><code>## [1] &quot;X1&quot; &quot;X2&quot; &quot;X3&quot; &quot;X4&quot; &quot;X5&quot; &quot;X6&quot; &quot;X7&quot; &quot;X8&quot;
</code></pre>
<pre><code class="language-r">set.seed(0)
names(gcSample) &lt;- sample(seq(0,28,by=4),8)
names(gcSample)
</code></pre>
<pre><code>## [1] &quot;20&quot; &quot;0&quot;  &quot;12&quot; &quot;24&quot; &quot;4&quot;  &quot;16&quot; &quot;8&quot;  &quot;28&quot;
</code></pre>
<pre><code class="language-r">ck &lt;- compareCluster(geneClusters = gcSample, fun = &quot;enrichKEGG&quot;)
</code></pre>
<p>比如下面的例子中, 我们是想让 x 轴依数字大小(Time)排序的. 但是由于这个顺序与 <code>list</code> 顺序不同, 导致结果差强人意.</p>
<pre><code class="language-r">dotplot(ck)
</code></pre>
<img src="bio-spring/post/2018/11/26/enrichplot-fancy-label/index.zh_files/figure-html/unnamed-chunk-7-1.png" width="960" />
<p>这只是一个 <code>list</code> 输入的例子, 可以通过改 name 变更顺序(就行我刚刚做的那样). 但是, 如果数据是放在 <code>data.frame</code> 中的, 存在多个分组条件, 每个条件按因子的 <code>level</code> 排好序.
那么由于 <code>compareCluster</code> 和 <code>dotplot</code> 操作时会将其转变成 <code>character</code>, 顺序会丢失, 导致最终结果是按照字母顺序输出的.</p>
<p>这种情况下, 你去改原始数据都是没有用的(需要给程序打补丁).</p>
<p>为了解决这个问题, 强行在 <strong>在已经输出的ggplot 对象上修改</strong>.</p>
<p>由于 <code>ggplot</code> 隐式输出的是一个对象, 其数据可以访问和修改. 出来的图, 先改一下再保存不就可以了吗?</p>
<pre><code class="language-r">p &lt;- dotplot(ck)

levels(p$data$Cluster)
</code></pre>
<pre><code>## [1] &quot;0\n(410)&quot;  &quot;12\n(195)&quot; &quot;24\n(441)&quot; &quot;4\n(481)&quot;  &quot;16\n(286)&quot; &quot;8\n(328)&quot; 
## [7] &quot;28\n(162)&quot;
</code></pre>
<pre><code class="language-r">p$data$Cluster &lt;- factor(p$data$Cluster, 
                         levels = c(&quot;0\n(245)&quot;, &quot;4\n(359)&quot;,  &quot;8\n(172)&quot;, &quot;12\n(412)&quot;, &quot;16\n(157)&quot;, &quot;20\n(388)&quot;,    &quot;24\n(301)&quot;),
                         labels = c(0,4,8,12,16,20,24))

p + xlab(&quot;Time (h)&quot;) + scale_y_discrete(label=short_label)
</code></pre>
<pre><code>## Scale for y is already present.
## Adding another scale for y, which will replace the existing scale.
</code></pre>
<img src="bio-spring/post/2018/11/26/enrichplot-fancy-label/index.zh_files/figure-html/unnamed-chunk-8-1.png" width="672" />
<p>这两种&quot;骚操作&quot;, 分别相当于基因表达时&quot;转录后修饰&quot;和&quot;翻译后修饰&quot;. 嗯, 是有这么个意思. 都是在 &ldquo;biobabble&rdquo; 公众号学到的, 结合具体问题分享一下. 共同进步吧!</p>

</div>
</main>

<section class="appendix">


<div>
  <div class="side side-left"><h3>作者简介</h3></div>
  <div>






</div>
</div>






<div>
  <div class="side side-left"><h3>重复使用</h3></div>
  Text and figures are licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC BY 4.0</a>. The source code is licensed under MIT. The full source is available at <a href="https://github.com/yihui/hugo-prose">https://github.com/yihui/hugo-prose</a>.
</div>



<div>
  <div class="side side-left"><h3>欢迎修订</h3></div>
  
  
  
    
  
  如果您发现本文里含有任何错误（包括错别字和标点符号），欢迎<a href="https://github.com/gaospecial/bio-spring/edit/master/content/post/2018-11-26-enrichplot-fancy-label/index.zh.Rmd" id="edit-link">在本站的 GitHub 项目里提交修订意见。</a>
</div>




<div>
  <div class="side side-left"><h3>引用本文</h3></div>
  <p>如果您使用了本文的内容，请按照以下方式引用：</p>
  <pre><code>gao (2018). 在enrichplot中使用更好的Label. BIO-SPRING. bio-spring/post/2018/11/26/enrichplot-fancy-label/</code></pre>
  <p>BibTeX citation</p>
  <pre><code>@misc{
  title = "在enrichplot中使用更好的Label",
  author = "gao",
  year = "2018",
  journal = "BIO-SPRING",
  note = "bio-spring/post/2018/11/26/enrichplot-fancy-label/"
}</code></pre>
</div>

</section>



<nav class="post-nav">
  <span class="nav-next">&larr; <a href="bio-spring/post/2018/11/20/comparing-dissimilarity-index/" title=下一篇&#32;(旧)>比较不同差异系数的结果</a></span>
  &hercon;
  <span class="nav-prev"><a href="bio-spring/post/2018/12/29/private-git-server/" title=上一篇&#32;(新)>设置私有 Git 服务器</a> &rarr;</span>
</nav>




<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//bio-spring.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var t = d.getElementById('disqus_thread');
    var b = false, l = function(scroll) {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
      if (scroll) t.scrollIntoView();
    }
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = 'Sorry, but you cannot make comments because Disqus failed to load for some reason. It is known to be blocked in China. If you are sure it is not blocked in your region, please refresh the page. 中国大陆地区读者需要翻墙才能发表评论。';
      t.style.border = '1px dashed';
      t.style.padding = '.5em';
      t.style.background = 'lightyellow';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment-[0-9]+$/)) return l(true);
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


</div>


  <footer>
  
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>



<script src="//yihui.org/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



      <script async src="https://www.googletagmanager.com/gtag/js?id=G-77M8KZTCMR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-77M8KZTCMR');
        }
      </script>


<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/number-sections.min.js,npm/@xiee/utils/js/toc.min.js,npm/@xiee/utils/js/toc-highlight.min.js,npm/@xiee/utils/js/sidenotes.min.js,npm/@xiee/utils/js/right-quote.min.js,npm/@xiee/utils/js/center-img.min.js,npm/@xiee/utils/js/fix-pandoc.min.js,npm/@xiee/utils/js/heading-anchor.min.js" defer></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/prism-xcode.min.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>


  <div class="footer">
  
  <ul class="copyright">
    <li>© <a href="https://bio-spring.top">Bio-Spring</a> 2006 &ndash; 2025 <a href="https://beian.miit.gov.cn">豫ICP备2021003240号</a></li>
  </ul>
  
  <ul>
    
    <li>
      <a href="/bio-spring/404.html">Contact</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/categories/">Categories</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/tags/">Tags</a>
    </li>
    
    <li id="menu-edit">
      <a href="#">Suggest an edit</a>
    </li>
    
    <li>
      <a href="#">Back to top</a>
    </li>
    
  </ul>
  </div>
  
  </footer>
  <script src="/bio-spring/js/features.js" defer></script>
  </body>
</html>

