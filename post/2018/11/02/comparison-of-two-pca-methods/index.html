<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> 比较 stats::procmp() 和 vegan::rda() 两种方法 | BIO-SPRING</title>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@v1.13.54/css/article.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/heading-anchor.min.css">
    <link rel="stylesheet" href="/bio-spring/css/style.css" />
    <link rel="stylesheet" href="/bio-spring/css/fonts.css" />
    <link rel="stylesheet" href="/bio-spring/css/custom.css" />
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="比较 stats::procmp() 和 vegan::rda() 两种方法">
  <meta name="twitter:description" content="上次提及 PCA 分析的方法有很多种。那不同方法之间的得到的结果会有差异吗？
最近采用 PCA 分析 RNA-seq 样本之间的差异，得到了下面的结果。
生成示例数据 生成一个含有 1000 个基因, 27 个样品的数据集. 这 27 个样品来自于 3 个基因型(WT, Mutant1, Mutant2), 3 种处理(CK, Trt1, Trt2), 共分为 \(3 * 3 = 9\) 组, 每组 3 个重复, 合计 27 个样品.
library(DESeq2) library(dplyr) library(ggplot2) theme_set(theme_bw()) dds &lt;- makeExampleDESeqDataSet(n = 1000, m=27) dds$condition &lt;- factor(rep(rep(c(&#34;Ctrl&#34;,&#34;Trt1&#34;,&#34;Trt2&#34;),3), 3)) dds$genotype &lt;- factor(rep(rep(c(&#34;WT&#34;,&#34;MuA&#34;,&#34;MuB&#34;), each=3),3)) # sample table sample_table &lt;- colData(dds) %&gt;% as.data.frame() %&gt;% tibble::rownames_to_column(var=&#34;sample_id&#34;) # 做 log2 变换 rld &lt;- rlog(dds, blind = F) 使用 stats::prcomp() 进行主成分分析 # 运行 PCA pca &lt;- stats::prcomp(t(assay(rld))) # 计算解释度 percent_var &lt;- pca$sdev^2/sum(pca$sdev^2) # 绘图 df &lt;- data.frame(PC1=pca$x[,1], PC2=pca$x[,2], sample_id=colnames(rld)) %&gt;% left_join(sample_table) mapping &lt;- aes(PC1, PC2, color=condition, shape=genotype,label=sample_id) p1 &lt;- ggplot(df,mapping) &#43; geom_point(size=3) &#43; ggrepel::geom_text_repel(show.legend = F) &#43; xlab(paste0(&#34;PC1: &#34;, round(percent_var[1] * 100), &#34;% variance&#34;)) &#43; ylab(paste0(&#34;PC2: &#34;, round(percent_var[2] * 100), &#34;% variance&#34;)) &#43; ggtitle(&#34;method: stats::prcomp()&#34;) p1 使用 vegan::rda() 做主成分分析 # rda() 分析 pca &lt;- vegan::rda(t(assay(rld))) # 计算解释度 percent_var &lt;- pca$CA$eig/pca$tot.chi # rda() 的结果中信息比较完整 df &lt;- vegan::scores(pca)$sites %&gt;% as.data.frame() %&gt;% tibble::rownames_to_column(var=&#34;sample_id&#34;) %&gt;% left_join(sample_table) p2 &lt;- ggplot(df,mapping) &#43; geom_point(size=3) &#43; ggrepel::geom_text_repel(show.legend = F) &#43; xlab(paste0(&#34;PC1: &#34;, round(percent_var[1] * 100), &#34;% variance&#34;)) &#43; ylab(paste0(&#34;PC2: &#34;, round(percent_var[2] * 100), &#34;% variance&#34;)) &#43; ggtitle(&#34;method: vegan::rda()&#34;) p2 放在一起比较一下 可以看出，虽然两种方法计算的数值有差异，但是坐标位置是一致。">


  </head>

  <body>

    <nav class="menu sticky-top">
    <ul>
      <li class="left">
        <a href="/"><span>BIO-SPRING</span></a>
      </li>
      
      <li>
        <a href="/bio-spring">Home</a>
      </li>
      
      <li>
        <a href="/bio-spring/post/">Blog Post</a>
      </li>
      
      <li>
        <a href="/bio-spring/publication/full-publication-list/">Publication</a>
      </li>
      
      <li>
        <a href="/bio-spring/work/">Work</a>
      </li>
      
      <li id="menu-search">
        <a href="/bio-spring/#">Search</a>
      </li>
      
    </ul>
    </nav>


<div class="container single">
<main>

<div class="article-meta">
<h1><span class="title">比较 stats::procmp() 和 vegan::rda() 两种方法</span></h1>

<h3 class="author">
Gao
</h3>

<h3 class="date">2018-11-02</h3>
<p class="terms">
  
  
  Categories: <a href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF">信息技术</a> 
  
  
  
  Tags: <a href="/tags/r">R</a> <a href="/tags/pca">PCA</a> <a href="/tags/statistics">statistics</a> 
  
  
</p>
</div>

<div class="article">
<p>上次提及 PCA 分析的方法有很多种。那不同方法之间的得到的结果会有差异吗？</p>
<p>最近采用 PCA 分析 RNA-seq 样本之间的差异，得到了下面的结果。</p>
<h1 id="生成示例数据">生成示例数据</h1>
<p>生成一个含有 1000 个基因, 27 个样品的数据集.
这 27 个样品来自于 3 个基因型(WT, Mutant1, Mutant2),
3 种处理(CK, Trt1, Trt2), 共分为 <code>\(3 * 3 = 9\)</code> 组,
每组 3 个重复, 合计 27 个样品.</p>
<pre><code class="language-r">library(DESeq2)
library(dplyr)
library(ggplot2)
theme_set(theme_bw())

dds &lt;- makeExampleDESeqDataSet(n = 1000, m=27)
dds$condition &lt;- factor(rep(rep(c(&quot;Ctrl&quot;,&quot;Trt1&quot;,&quot;Trt2&quot;),3), 3))
dds$genotype &lt;- factor(rep(rep(c(&quot;WT&quot;,&quot;MuA&quot;,&quot;MuB&quot;), each=3),3))

# sample table
sample_table &lt;- colData(dds) %&gt;% as.data.frame() %&gt;%
  tibble::rownames_to_column(var=&quot;sample_id&quot;)

# 做 log2 变换
rld &lt;- rlog(dds, blind = F)
</code></pre>
<h1 id="使用-statsprcomp-进行主成分分析">使用 <code>stats::prcomp()</code> 进行主成分分析</h1>
<pre><code class="language-r"># 运行 PCA
pca &lt;- stats::prcomp(t(assay(rld)))

# 计算解释度
percent_var &lt;- pca$sdev^2/sum(pca$sdev^2)

# 绘图
df &lt;- data.frame(PC1=pca$x[,1], 
PC2=pca$x[,2], sample_id=colnames(rld)) %&gt;% 
  left_join(sample_table)

mapping &lt;- aes(PC1, PC2, color=condition, shape=genotype,label=sample_id)

p1 &lt;- ggplot(df,mapping) +
    geom_point(size=3) +
    ggrepel::geom_text_repel(show.legend = F) +
    xlab(paste0(&quot;PC1: &quot;, round(percent_var[1] * 100), &quot;% variance&quot;)) + 
    ylab(paste0(&quot;PC2: &quot;, round(percent_var[2] * 100), &quot;% variance&quot;)) +
    ggtitle(&quot;method: stats::prcomp()&quot;)
    
p1
</code></pre>
<img src="bio-spring/post/2018/11/02/comparison-of-two-pca-methods/index.zh_files/figure-html/pca1-1.png" width="768" />
<h1 id="使用-veganrda-做主成分分析">使用 <code>vegan::rda()</code> 做主成分分析</h1>
<pre><code class="language-r"># rda() 分析
pca &lt;- vegan::rda(t(assay(rld))) 

# 计算解释度
percent_var &lt;- pca$CA$eig/pca$tot.chi  # rda() 的结果中信息比较完整
df &lt;- vegan::scores(pca)$sites %&gt;% 
  as.data.frame() %&gt;%
  tibble::rownames_to_column(var=&quot;sample_id&quot;) %&gt;%
  left_join(sample_table)

p2 &lt;- ggplot(df,mapping) +
    geom_point(size=3) +
    ggrepel::geom_text_repel(show.legend = F) +
    xlab(paste0(&quot;PC1: &quot;, round(percent_var[1] * 100), &quot;% variance&quot;)) + 
    ylab(paste0(&quot;PC2: &quot;, round(percent_var[2] * 100), &quot;% variance&quot;)) + 
  ggtitle(&quot;method: vegan::rda()&quot;)

p2
</code></pre>
<img src="bio-spring/post/2018/11/02/comparison-of-two-pca-methods/index.zh_files/figure-html/pca2-1.png" width="768" />
<h1 id="放在一起比较一下">放在一起比较一下</h1>
<p>可以看出，虽然两种方法计算的数值有差异，但是坐标位置是一致。</p>
<pre><code class="language-r">cowplot::plot_grid(p1,p2,labels = &quot;AUTO&quot;,ncol=1,align = &quot;hv&quot;)
</code></pre>
<img src="bio-spring/post/2018/11/02/comparison-of-two-pca-methods/index.zh_files/figure-html/pca_plot-1.png" width="768" />

</div>
</main>

<section class="appendix">


<div>
  <div class="side side-left"><h3>作者简介</h3></div>
  <div>






</div>
</div>






<div>
  <div class="side side-left"><h3>重复使用</h3></div>
  Text and figures are licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC BY 4.0</a>. The source code is licensed under MIT. The full source is available at <a href="https://github.com/yihui/hugo-prose">https://github.com/yihui/hugo-prose</a>.
</div>



<div>
  <div class="side side-left"><h3>欢迎修订</h3></div>
  
  
  
    
  
  如果您发现本文里含有任何错误（包括错别字和标点符号），欢迎<a href="https://github.com/gaospecial/bio-spring/edit/master/content/post/2018-11-02-comparison-of-two-pca-methods/index.zh.Rmd" id="edit-link">在本站的 GitHub 项目里提交修订意见。</a>
</div>




<div>
  <div class="side side-left"><h3>引用本文</h3></div>
  <p>如果您使用了本文的内容，请按照以下方式引用：</p>
  <pre><code>Gao (2018). 比较 stats::procmp() 和 vegan::rda() 两种方法. BIO-SPRING. bio-spring/post/2018/11/02/comparison-of-two-pca-methods/</code></pre>
  <p>BibTeX citation</p>
  <pre><code>@misc{
  title = "比较 stats::procmp() 和 vegan::rda() 两种方法",
  author = "Gao",
  year = "2018",
  journal = "BIO-SPRING",
  note = "bio-spring/post/2018/11/02/comparison-of-two-pca-methods/"
}</code></pre>
</div>

</section>



<nav class="post-nav">
  <span class="nav-next">&larr; <a href="bio-spring/post/2018/10/24/donot-use-the-git-gui-of-rstudio/" title=下一篇&#32;(旧)>不要在RStudio中使用Git GUI</a></span>
  &hercon;
  <span class="nav-prev"><a href="bio-spring/post/2018/11/13/rt-pcr-data-visualization-one/" title=上一篇&#32;(新)>RT-PCR数据可视化之一</a> &rarr;</span>
</nav>




<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//bio-spring.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var t = d.getElementById('disqus_thread');
    var b = false, l = function(scroll) {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
      if (scroll) t.scrollIntoView();
    }
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = 'Sorry, but you cannot make comments because Disqus failed to load for some reason. It is known to be blocked in China. If you are sure it is not blocked in your region, please refresh the page. 中国大陆地区读者需要翻墙才能发表评论。';
      t.style.border = '1px dashed';
      t.style.padding = '.5em';
      t.style.background = 'lightyellow';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment-[0-9]+$/)) return l(true);
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


</div>


  <footer>
  
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>



<script src="//yihui.org/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



      <script async src="https://www.googletagmanager.com/gtag/js?id=G-77M8KZTCMR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-77M8KZTCMR');
        }
      </script>


<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/number-sections.min.js,npm/@xiee/utils/js/toc.min.js,npm/@xiee/utils/js/toc-highlight.min.js,npm/@xiee/utils/js/sidenotes.min.js,npm/@xiee/utils/js/right-quote.min.js,npm/@xiee/utils/js/center-img.min.js,npm/@xiee/utils/js/fix-pandoc.min.js,npm/@xiee/utils/js/heading-anchor.min.js" defer></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/prism-xcode.min.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>


  <div class="footer">
  
  <ul class="copyright">
    <li>© <a href="https://bio-spring.top">Bio-Spring</a> 2006 &ndash; 2025 <a href="https://beian.miit.gov.cn">豫ICP备2021003240号</a></li>
  </ul>
  
  <ul>
    
    <li>
      <a href="/bio-spring/404.html">Contact</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/categories/">Categories</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/tags/">Tags</a>
    </li>
    
    <li id="menu-edit">
      <a href="#">Suggest an edit</a>
    </li>
    
    <li>
      <a href="#">Back to top</a>
    </li>
    
  </ul>
  </div>
  
  </footer>
  <script src="/bio-spring/js/features.js" defer></script>
  </body>
</html>

