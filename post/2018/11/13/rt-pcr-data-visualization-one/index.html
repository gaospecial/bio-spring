<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> RT-PCR数据可视化之一 | BIO-SPRING</title>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@v1.13.54/css/article.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/heading-anchor.min.css">
    <link rel="stylesheet" href="/bio-spring/css/style.css" />
    <link rel="stylesheet" href="/bio-spring/css/fonts.css" />
    <link rel="stylesheet" href="/bio-spring/css/custom.css" />
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="RT-PCR数据可视化之一">
  <meta name="twitter:description" content="QuantStudio Real-Time PCR software 是我们经常使用的 RT-PCR 软件, 它上面的可视化只能简单看看, 不满足发论文的需求. 如果需要得到发表级的图片, 还是需要 用 ggplot 大法加持.
为了能够使用这些数据, 首先需要导出文件. 为了方便操作, 文件导出时, 选择 *.txt 格式, 每个面板导出成一个单独文件. 将文件放在 data 文件夹中.
数据预处理 根据文件名后缀找到数据.
# 数据文件目录 dir &lt;- &#34;data&#34; options(stringsAsFactors = F) # 根据文件名后缀找到对应文件 amplification_file &lt;- list.files(path=dir,full.names = T,pattern = &#34;Amplification Data_ViiA7_export.txt&#34;) result_file &lt;- list.files(path=dir,full.names = T,pattern = &#34;Results_ViiA7_export.txt&#34;) meltcurve_file &lt;- list.files(path=dir,full.names = T,pattern = &#34;MeltCurve Data_ViiA7_export.txt&#34;) 我们使用 readr 来读取数据. 这个包避免了 R 语言对列名不合时宜的转换.
每个文件的前面 43 列都是基本描述信息, 选择略过. 读取接下来的数据表格.">


  </head>

  <body>

    <nav class="menu sticky-top">
    <ul>
      <li class="left">
        <a href="/"><span>BIO-SPRING</span></a>
      </li>
      
      <li>
        <a href="/bio-spring">Home</a>
      </li>
      
      <li>
        <a href="/bio-spring/post/">Blog Post</a>
      </li>
      
      <li>
        <a href="/bio-spring/publication/full-publication-list/">Publication</a>
      </li>
      
      <li>
        <a href="/bio-spring/work/">Work</a>
      </li>
      
      <li id="menu-search">
        <a href="/bio-spring/#">Search</a>
      </li>
      
    </ul>
    </nav>


<div class="container single">
<main>

<div class="article-meta">
<h1><span class="title">RT-PCR数据可视化之一</span></h1>

<h3 class="author">
gaoch
</h3>

<h3 class="date">2018-11-13</h3>
<p class="terms">
  
  
  Categories: <a href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF">信息技术</a> <a href="/categories/%E7%94%9F%E7%89%A9%E5%AD%A6">生物学</a> 
  
  
  
  Tags: <a href="/tags/ggplot2">ggplot2</a> <a href="/tags/r">R</a> <a href="/tags/rt-pcr">RT-PCR</a> 
  
  
</p>
</div>

<div class="article">
<p>QuantStudio Real-Time PCR software 是我们经常使用的 RT-PCR 软件, 它上面的可视化只能简单看看, 不满足发论文的需求. 如果需要得到发表级的图片, 还是需要 用 ggplot 大法加持.</p>
<p>为了能够使用这些数据, 首先需要导出文件. 为了方便操作, 文件导出时, 选择 <code>*.txt</code> 格式, 每个面板导出成一个单独文件. 将文件放在 <code>data</code> 文件夹中.</p>
<h1 id="数据预处理">数据预处理</h1>
<p>根据文件名后缀找到数据.</p>
<pre><code class="language-r"># 数据文件目录
dir &lt;- &quot;data&quot;
options(stringsAsFactors = F)

# 根据文件名后缀找到对应文件
amplification_file &lt;- list.files(path=dir,full.names = T,pattern = &quot;Amplification Data_ViiA7_export.txt&quot;)
result_file &lt;- list.files(path=dir,full.names = T,pattern = &quot;Results_ViiA7_export.txt&quot;)
meltcurve_file &lt;- list.files(path=dir,full.names = T,pattern = &quot;MeltCurve Data_ViiA7_export.txt&quot;)
</code></pre>
<p>我们使用 <code>readr</code> 来读取数据. 这个包避免了 R 语言对列名不合时宜的转换.</p>
<p>每个文件的前面 43 列都是基本描述信息, 选择略过. 读取接下来的数据表格.</p>
<p>在 <code>results</code> 文件中, CT 值的缺失值用 <code>&quot;Undermined&quot;</code> 表示. 另外, 该文件末尾的也需要检查一下, 如果有非数据信息要删掉. 否则读取文件会报错.</p>
<pre><code class="language-r"># 读取文件
library(tidyr)
library(dplyr)
library(readr)

# read
amplification &lt;- read_delim(amplification_file,&quot;\t&quot;,skip = 43)
raw_results &lt;-  read_delim(result_file,&quot;\t&quot;,skip = 43,na = &quot;Undetermined&quot;)
meltcurve &lt;-  read_delim(meltcurve_file,&quot;\t&quot;,skip = 43)
</code></pre>
<p>在 <code>&quot;Results&quot;</code> 文件中, 含有我们定义的 <code>&quot;Sample Name&quot;</code> 和 <code>&quot;Target Name&quot;</code>, 而在另外两个文件中不存在. 为了能够在图中显示这些信息, 我们需要将这些信息提取出来, 并添加到另外两个文件数据中. 添加时, 按照 <code>&quot;Well&quot;</code> 合并即可.</p>
<pre><code class="language-r"># 修整数据
meta &lt;- raw_results %&gt;% select(Well, `Sample Name`, `Target Name`)
amplification &lt;- amplification %&gt;% select(Well,Cycle,Rn,`Delta Rn`) %&gt;%  
  left_join(meta) %&gt;%
  filter(Well&lt;=5)
meltcurve &lt;- meltcurve %&gt;% 
  select(Well,Reading,Temperature,Fluorescence,Derivative) %&gt;% 
  filter(!is.na(Fluorescence)) %&gt;%
  left_join(meta)%&gt;%
  filter(Well&lt;=5)
</code></pre>
<h1 id="可视化">可视化</h1>
<h2 id="扩增曲线">扩增曲线</h2>
<p>首先绘制扩增曲线. 扩增曲线描述 RT-PCR 荧光信号随循环数的变化情况.</p>
<pre><code class="language-r">library(ggplot2)

# 更好看的科学计数法
fancy_scientific &lt;- function(l) {
  # turn in to character string in scientific notation
  l &lt;- format(l, scientific = TRUE)
  # quote the part before the exponent to keep all the digits
  l &lt;- gsub(&quot;^(.*)e&quot;, &quot;'\\1'e&quot;, l)
  # turn the 'e+' into plotmath format
  l &lt;- gsub(&quot;e&quot;, &quot;%*%10^&quot;, l)
  # remove +
  l &lt;- gsub(&quot;\\+&quot;,&quot;&quot;,l)
  # return this as an expression
  parse(text=l)
}

ggplot(amplification,aes(Cycle,Rn,group=Well, color=`Target Name`,shape=`Sample Name`)) + 
  geom_line() +
  scale_y_continuous(labels=fancy_scientific)
</code></pre>
<h2 id="溶解曲线">溶解曲线</h2>
<p>溶解曲线可以看出扩增产物的特异性.</p>
<pre><code class="language-r">ggplot(meltcurve,aes(Temperature,Derivative,group=Well,color=`Target Name`)) + 
  geom_line()
</code></pre>

</div>
</main>

<section class="appendix">


<div>
  <div class="side side-left"><h3>作者简介</h3></div>
  <div>





<div>Chun-Hui Gao is a Research Associate at <a href="http://www.hzau.edu.cn">Huazhong Agricultural University</a>.</div>


</div>
</div>






<div>
  <div class="side side-left"><h3>重复使用</h3></div>
  Text and figures are licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC BY 4.0</a>. The source code is licensed under MIT. The full source is available at <a href="https://github.com/yihui/hugo-prose">https://github.com/yihui/hugo-prose</a>.
</div>



<div>
  <div class="side side-left"><h3>欢迎修订</h3></div>
  
  
  
    
  
  如果您发现本文里含有任何错误（包括错别字和标点符号），欢迎<a href="https://github.com/gaospecial/bio-spring/edit/master/content/post/2018-11-13-rt-pcr-melting-curve/index.zh.Rmd" id="edit-link">在本站的 GitHub 项目里提交修订意见。</a>
</div>




<div>
  <div class="side side-left"><h3>引用本文</h3></div>
  <p>如果您使用了本文的内容，请按照以下方式引用：</p>
  <pre><code>gaoch (2018). RT-PCR数据可视化之一. BIO-SPRING. bio-spring/post/2018/11/13/rt-pcr-data-visualization-one/</code></pre>
  <p>BibTeX citation</p>
  <pre><code>@misc{
  title = "RT-PCR数据可视化之一",
  author = "gaoch",
  year = "2018",
  journal = "BIO-SPRING",
  note = "bio-spring/post/2018/11/13/rt-pcr-data-visualization-one/"
}</code></pre>
</div>

</section>



<nav class="post-nav">
  <span class="nav-next">&larr; <a href="bio-spring/post/2018/11/02/comparison-of-two-pca-methods/" title=下一篇&#32;(旧)>比较 stats::procmp() 和 vegan::rda() 两种方法</a></span>
  &hercon;
  <span class="nav-prev"><a href="bio-spring/post/2018/11/20/comparing-dissimilarity-index/" title=上一篇&#32;(新)>比较不同差异系数的结果</a> &rarr;</span>
</nav>




<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//bio-spring.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var t = d.getElementById('disqus_thread');
    var b = false, l = function(scroll) {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
      if (scroll) t.scrollIntoView();
    }
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = 'Sorry, but you cannot make comments because Disqus failed to load for some reason. It is known to be blocked in China. If you are sure it is not blocked in your region, please refresh the page. 中国大陆地区读者需要翻墙才能发表评论。';
      t.style.border = '1px dashed';
      t.style.padding = '.5em';
      t.style.background = 'lightyellow';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment-[0-9]+$/)) return l(true);
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


</div>


  <footer>
  
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>



<script src="//yihui.org/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



      <script async src="https://www.googletagmanager.com/gtag/js?id=G-77M8KZTCMR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-77M8KZTCMR');
        }
      </script>


<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/number-sections.min.js,npm/@xiee/utils/js/toc.min.js,npm/@xiee/utils/js/toc-highlight.min.js,npm/@xiee/utils/js/sidenotes.min.js,npm/@xiee/utils/js/right-quote.min.js,npm/@xiee/utils/js/center-img.min.js,npm/@xiee/utils/js/fix-pandoc.min.js,npm/@xiee/utils/js/heading-anchor.min.js" defer></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/prism-xcode.min.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>


  <div class="footer">
  
  <ul class="copyright">
    <li>© <a href="https://bio-spring.top">Bio-Spring</a> 2006 &ndash; 2025 <a href="https://beian.miit.gov.cn">豫ICP备2021003240号</a></li>
  </ul>
  
  <ul>
    
    <li>
      <a href="/bio-spring/404.html">Contact</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/categories/">Categories</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/tags/">Tags</a>
    </li>
    
    <li id="menu-edit">
      <a href="#">Suggest an edit</a>
    </li>
    
    <li>
      <a href="#">Back to top</a>
    </li>
    
  </ul>
  </div>
  
  </footer>
  <script src="/bio-spring/js/features.js" defer></script>
  </body>
</html>

