<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> 绘制随机森林模型的Gini重要性 | BIO-SPRING</title>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils@v1.13.54/css/article.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/heading-anchor.min.css">
    <link rel="stylesheet" href="/bio-spring/css/style.css" />
    <link rel="stylesheet" href="/bio-spring/css/fonts.css" />
    <link rel="stylesheet" href="/bio-spring/css/custom.css" />
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="绘制随机森林模型的Gini重要性">
  <meta name="twitter:description" content="在随机森林模型中，mean decrease in gini index（也称为Gini重要性或基尼指数下降均值）用于衡量各特征对模型分类性能的贡献。
输出解释 每个柱状条的高度表示该特征对分类器性能的相对贡献，数值越大表示重要性越高。 特征可以按重要性从高到低排序，以便更直观地理解哪些变量在模型中最重要。 可以通过以下步骤绘制它：
Python 示例 假设使用的是 scikit-learn 的随机森林实现：
import matplotlib.pyplot as plt import numpy as np from sklearn.ensemble import RandomForestClassifier from sklearn.datasets import load_iris # 加载数据集 data = load_iris() X = data.data y = data.target feature_names = data.feature_names # 训练随机森林模型 rf = RandomForestClassifier(n_estimators=100, random_state=42) rf.fit(X, y) RandomForestClassifier(random_state=42)In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.RandomForestClassifierRandomForestClassifier(random_state=42) # 获取 Gini 重要性 importances = rf.feature_importances_ # 对特征重要性排序 indices = np.argsort(importances)[::-1] # 绘制柱状图 plt.figure(figsize=(10, 6)) plt.title(&#34;Feature Importance (Mean Decrease in Gini Index)&#34;) plt.bar(range(X.shape[1]), importances[indices], align=&#34;center&#34;) plt.xticks(range(X.shape[1]), [feature_names[i] for i in indices]) ## ([&lt;matplotlib.axis.XTick object at 0x1690cd650&gt;, &lt;matplotlib.axis.XTick object at 0x1690dc5d0&gt;, &lt;matplotlib.axis.XTick object at 0x1690dd110&gt;, &lt;matplotlib.axis.XTick object at 0x169142f90&gt;], [Text(0, 0, &#39;petal length (cm)&#39;), Text(1, 0, &#39;petal width (cm)&#39;), Text(2, 0, &#39;sepal length (cm)&#39;), Text(3, 0, &#39;sepal width (cm)&#39;)]) plt.xlabel(&#34;Features&#34;) plt.ylabel(&#34;Importance Score&#34;) plt.tight_layout() plt.show() R 示例 在 R 中，可以使用 randomForest 包来计算和绘制 Mean Decrease in Gini：">


  </head>

  <body>

    <nav class="menu sticky-top">
    <ul>
      <li class="left">
        <a href="/"><span>BIO-SPRING</span></a>
      </li>
      
      <li>
        <a href="/bio-spring">Home</a>
      </li>
      
      <li>
        <a href="/bio-spring/post/">Blog Post</a>
      </li>
      
      <li>
        <a href="/bio-spring/publication/full-publication-list/">Publication</a>
      </li>
      
      <li>
        <a href="/bio-spring/work/">Work</a>
      </li>
      
      <li id="menu-search">
        <a href="/bio-spring/#">Search</a>
      </li>
      
    </ul>
    </nav>


<div class="container single">
<main>

<div class="article-meta">
<h1><span class="title">绘制随机森林模型的Gini重要性</span></h1>

<h3 class="author">
gaoch
</h3>

<h3 class="date">2024-11-26</h3>
<p class="terms">
  
  
  Categories: <a href="/categories/%E5%85%B6%E5%AE%83">其它</a> <a href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF">信息技术</a> 
  
  
  
  Tags: <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">学习笔记</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0">机器学习</a> 
  
  
</p>
</div>

<div class="article">
<p>在随机森林模型中，<code>mean decrease in gini index</code>（也称为Gini重要性或基尼指数下降均值）用于衡量各特征对模型分类性能的贡献。</p>
<h2 id="输出解释">输出解释</h2>
<ul>
<li>每个柱状条的高度表示该特征对分类器性能的相对贡献，数值越大表示重要性越高。</li>
<li>特征可以按重要性从高到低排序，以便更直观地理解哪些变量在模型中最重要。</li>
</ul>
<p>可以通过以下步骤绘制它：</p>
<h2 id="python-示例">Python 示例</h2>
<p>假设使用的是 <code>scikit-learn</code> 的随机森林实现：</p>
<pre><code class="language-python">import matplotlib.pyplot as plt
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.datasets import load_iris

# 加载数据集
data = load_iris()
X = data.data
y = data.target
feature_names = data.feature_names

# 训练随机森林模型
rf = RandomForestClassifier(n_estimators=100, random_state=42)
rf.fit(X, y)
</code></pre>
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(random_state=42)</pre></div></div></div></div></div>
<pre><code class="language-python"># 获取 Gini 重要性
importances = rf.feature_importances_

# 对特征重要性排序
indices = np.argsort(importances)[::-1]

# 绘制柱状图
plt.figure(figsize=(10, 6))
plt.title(&quot;Feature Importance (Mean Decrease in Gini Index)&quot;)
plt.bar(range(X.shape[1]), importances[indices], align=&quot;center&quot;)
plt.xticks(range(X.shape[1]), [feature_names[i] for i in indices])
</code></pre>
<pre><code>## ([&lt;matplotlib.axis.XTick object at 0x1690cd650&gt;, &lt;matplotlib.axis.XTick object at 0x1690dc5d0&gt;, &lt;matplotlib.axis.XTick object at 0x1690dd110&gt;, &lt;matplotlib.axis.XTick object at 0x169142f90&gt;], [Text(0, 0, 'petal length (cm)'), Text(1, 0, 'petal width (cm)'), Text(2, 0, 'sepal length (cm)'), Text(3, 0, 'sepal width (cm)')])
</code></pre>
<pre><code class="language-python">plt.xlabel(&quot;Features&quot;)
plt.ylabel(&quot;Importance Score&quot;)
plt.tight_layout()
plt.show()
</code></pre>
<img src="bio-spring/post/2024/11/26/random-forest-gini-index/index.zh_files/figure-html/unnamed-chunk-1-1.png" width="960" />
<h2 id="r-示例">R 示例</h2>
<p>在 R 中，可以使用 <code>randomForest</code> 包来计算和绘制 <code>Mean Decrease in Gini</code>：</p>
<pre><code class="language-r">library(randomForest)
</code></pre>
<pre><code>## randomForest 4.7-1.1

## Type rfNews() to see new features/changes/bug fixes.
</code></pre>
<pre><code class="language-r"># 加载示例数据集
data(iris)
set.seed(42)

# 训练随机森林模型
rf_model = randomForest(Species ~ ., data = iris, importance = TRUE)

# 提取 Gini 重要性
importance_data = importance(rf_model, type = 2)
feature_names = rownames(importance_data)

# 排序数据
sorted_indices = order(importance_data[, &quot;MeanDecreaseGini&quot;], decreasing = TRUE)
sorted_importance = importance_data[sorted_indices, &quot;MeanDecreaseGini&quot;]
sorted_feature_names = feature_names[sorted_indices]

# 绘制柱状图
barplot(sorted_importance,
        names.arg = sorted_feature_names,
        las = 2, col = &quot;steelblue&quot;,
        main = &quot;Feature Importance (Mean Decrease in Gini Index)&quot;,
        xlab = &quot;Features&quot;, ylab = &quot;Importance Score&quot;,
        cex.names = 0.8) # 缩小标签字体以避免重叠
</code></pre>
<img src="bio-spring/post/2024/11/26/random-forest-gini-index/index.zh_files/figure-html/unnamed-chunk-2-3.png" width="672" />
<h2 id="使用-tidymodels-框架">使用 <code>tidymodels</code> 框架</h2>
<p>使用 <code>tidymodels</code> 框架，可以通过 <code>vip</code>（Variable Importance Plots）包来绘制随机森林模型的 <code>Mean Decrease in Gini Index</code>。以下是实现方法：</p>
<h3 id="安装必要的包">安装必要的包</h3>
<p>确保安装以下包：</p>
<pre><code class="language-r">install.packages(&quot;tidymodels&quot;)
install.packages(&quot;vip&quot;)
</code></pre>
<h3 id="示例代码">示例代码</h3>
<p>以下以 <code>iris</code> 数据集为例：</p>
<pre><code class="language-r">library(tidymodels)
</code></pre>
<pre><code>## ── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──

## ✔ broom        1.0.5     ✔ recipes      1.0.9
## ✔ dials        1.2.0     ✔ rsample      1.2.0
## ✔ dplyr        1.1.4     ✔ tibble       3.2.1
## ✔ ggplot2      3.5.1     ✔ tidyr        1.3.1
## ✔ infer        1.0.5     ✔ tune         1.1.2
## ✔ modeldata    1.2.0     ✔ workflows    1.1.3
## ✔ parsnip      1.1.1     ✔ workflowsets 1.0.1
## ✔ purrr        1.0.2     ✔ yardstick    1.2.0

## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
## ✖ dplyr::combine()  masks randomForest::combine()
## ✖ purrr::discard()  masks scales::discard()
## ✖ dplyr::filter()   masks stats::filter()
## ✖ dplyr::lag()      masks stats::lag()
## ✖ ggplot2::margin() masks randomForest::margin()
## ✖ recipes::step()   masks stats::step()
## • Use tidymodels_prefer() to resolve common conflicts.
</code></pre>
<pre><code class="language-r">library(vip)
</code></pre>
<pre><code>## 
## Attaching package: 'vip'

## The following object is masked from 'package:utils':
## 
##     vi
</code></pre>
<pre><code class="language-r"># 加载数据集
data(iris)

# 定义数据拆分
set.seed(42)
iris_split = initial_split(iris, prop = 0.8)
iris_train = training(iris_split)
iris_test = testing(iris_split)

# 定义随机森林模型
rf_model = rand_forest(mtry = 2, trees = 100, min_n = 5) %&gt;%
  set_engine(&quot;ranger&quot;, importance = &quot;impurity&quot;) %&gt;%
  set_mode(&quot;classification&quot;)

# 定义工作流
rf_workflow = workflow() %&gt;%
  add_model(rf_model) %&gt;%
  add_formula(Species ~ .)

# 训练模型
rf_fit = fit(rf_workflow, data = iris_train)

# 提取变量重要性并绘图
rf_fit %&gt;%
  extract_fit_parsnip() %&gt;%
  vip(geom = &quot;col&quot;, aesthetics = list(fill = &quot;steelblue&quot;)) +
  labs(
    title = &quot;Feature Importance (Mean Decrease in Gini Index)&quot;,
    x = &quot;Features&quot;,
    y = &quot;Importance Score&quot;
  ) +
  theme_minimal()
</code></pre>
<img src="bio-spring/post/2024/11/26/random-forest-gini-index/index.zh_files/figure-html/unnamed-chunk-3-1.png" width="672" />
<h3 id="输出解释-1">输出解释</h3>
<ul>
<li><code>vip()</code> 函数会从模型中提取特征的重要性并绘制柱状图。</li>
<li>这里使用了 <code>ranger</code> 引擎，通过 <code>importance = &quot;impurity&quot;</code> 参数计算基尼指数下降。</li>
<li><code>geom = &quot;col&quot;</code> 绘制柱状图，并可以通过 <code>aesthetics</code> 自定义样式。</li>
</ul>
<h3 id="代码关键点">代码关键点</h3>
<ol>
<li><strong><code>vip</code> 包</strong>：方便地绘制变量重要性。</li>
<li><strong>随机森林引擎</strong>：选择 <code>ranger</code>，因为它支持计算基尼重要性。</li>
<li><strong>工作流</strong>：使用 <code>tidymodels</code> 的工作流整合模型和预处理过程。</li>
</ol>

</div>
</main>

<section class="appendix">


<div>
  <div class="side side-left"><h3>作者简介</h3></div>
  <div>





<div>Chun-Hui Gao is a Research Associate at <a href="http://www.hzau.edu.cn">Huazhong Agricultural University</a>.</div>


</div>
</div>






<div>
  <div class="side side-left"><h3>重复使用</h3></div>
  Text and figures are licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution CC BY 4.0</a>. The source code is licensed under MIT. The full source is available at <a href="https://github.com/yihui/hugo-prose">https://github.com/yihui/hugo-prose</a>.
</div>



<div>
  <div class="side side-left"><h3>欢迎修订</h3></div>
  
  
  
    
  
  如果您发现本文里含有任何错误（包括错别字和标点符号），欢迎<a href="https://github.com/gaospecial/bio-spring/edit/master/content/post/2024-11-26-random-forest-gini-index/index.zh.Rmd" id="edit-link">在本站的 GitHub 项目里提交修订意见。</a>
</div>




<div>
  <div class="side side-left"><h3>引用本文</h3></div>
  <p>如果您使用了本文的内容，请按照以下方式引用：</p>
  <pre><code>gaoch (2024). 绘制随机森林模型的Gini重要性. BIO-SPRING. bio-spring/post/2024/11/26/random-forest-gini-index/</code></pre>
  <p>BibTeX citation</p>
  <pre><code>@misc{
  title = "绘制随机森林模型的Gini重要性",
  author = "gaoch",
  year = "2024",
  journal = "BIO-SPRING",
  note = "bio-spring/post/2024/11/26/random-forest-gini-index/"
}</code></pre>
</div>

</section>



<nav class="post-nav">
  <span class="nav-next">&larr; <a href="bio-spring/post/2024/11/26/ai-rename-blogdown-tags/" title=下一篇&#32;(旧)>使用 AI 优化 blogdown 的分类和标签</a></span>
  &hercon;
  <span class="nav-prev"><a href="bio-spring/post/2024/11/26/pca-loading/" title=上一篇&#32;(新)>PCA loading</a> &rarr;</span>
</nav>




<section class="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//bio-spring.disqus.com/embed.js';
    var d = document, s = d.createElement('script');
    s.src = disqus_js; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    var t = d.getElementById('disqus_thread');
    var b = false, l = function(scroll) {
      if (b) return;
      (d.head || d.body).appendChild(s); b = true;
      if (scroll) t.scrollIntoView();
    }
    s.onerror = function(e) {
      if (sessionStorage.getItem('failure-note')) return;
      t.innerText = 'Sorry, but you cannot make comments because Disqus failed to load for some reason. It is known to be blocked in China. If you are sure it is not blocked in your region, please refresh the page. 中国大陆地区读者需要翻墙才能发表评论。';
      t.style.border = '1px dashed';
      t.style.padding = '.5em';
      t.style.background = 'lightyellow';
      sessionStorage.setItem('failure-note', true);
    };
    
    if (location.hash.match(/^#comment-[0-9]+$/)) return l(true);
    var c = function() {
      if (b) return;
      var rect = t.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) l();
    };
    window.addEventListener('load', c);
    d.addEventListener('scroll', c);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


</div>


  <footer>
  
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>





      <script async src="https://www.googletagmanager.com/gtag/js?id=G-77M8KZTCMR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-77M8KZTCMR');
        }
      </script>


<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/number-sections.min.js,npm/@xiee/utils/js/toc.min.js,npm/@xiee/utils/js/toc-highlight.min.js,npm/@xiee/utils/js/sidenotes.min.js,npm/@xiee/utils/js/right-quote.min.js,npm/@xiee/utils/js/center-img.min.js,npm/@xiee/utils/js/fix-pandoc.min.js,npm/@xiee/utils/js/heading-anchor.min.js" defer></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xiee/utils/css/prism-xcode.min.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>


  <div class="footer">
  
  <ul class="copyright">
    <li>© <a href="https://bio-spring.top">Bio-Spring</a> 2006 &ndash; 2025 <a href="https://beian.miit.gov.cn">豫ICP备2021003240号</a></li>
  </ul>
  
  <ul>
    
    <li>
      <a href="/bio-spring/404.html">Contact</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/categories/">Categories</a>
    </li>
    
    <li class="optional">
      <a href="/bio-spring/tags/">Tags</a>
    </li>
    
    <li id="menu-edit">
      <a href="#">Suggest an edit</a>
    </li>
    
    <li>
      <a href="#">Back to top</a>
    </li>
    
  </ul>
  </div>
  
  </footer>
  <script src="/bio-spring/js/features.js" defer></script>
  </body>
</html>

